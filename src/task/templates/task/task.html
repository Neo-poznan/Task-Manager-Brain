{% extends 'task/base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'user_form.css' %}">
<link rel="stylesheet" href="{% static 'task_creation_form.css' %}">
<script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
{% endblock %}

{% block content %}
<main>
    <div id="errors">
        {{ form.errors }}
    </div>
    <form action="" method="post">
        {% csrf_token %}

        {{ form.name.label_tag }}
        {{ form.name }}

        {{ form.description.label_tag }}
        <div id="rendering-content-container">
            <div  id="rendering-content" style="display: none;"></div>
            {{ form.description }}
        </div>

        {{ form.category.label_tag }}
        {{ form.category }}

        {{ form.deadline.label_tag }}
        {{ form.deadline }}

        {{ form.planed_time.label_tag }}
        {{ form.planed_time }}
        
    <button type="submit">Отправить</button>

</main>
<script>
    let container = document.getElementById('rendering-content-container');
    let textarea = document.getElementById('description-id-for-label');
    let renderingContentElement = document.getElementById('rendering-content');
    textarea.onblur = ( event ) => {
        textarea.style.display = 'none';
        renderingContentElement.style.display = 'block'
        if ( !event.target.value ) {
            renderingContentElement.innerHTML = '<p id="placeholder">Описание... (можно Markdown)</p>';
        }
        else {
            renderingContentElement.innerHTML = marked.parse(event.target.value);
        }
        
    }

    renderingContentElement.onclick = ( event ) => {
        renderingContentElement.style.display = 'none';
        textarea.style.display = 'block';
        textarea.focus();
    }

    function autoResize() {
        textarea.style.height = '300px';
        textarea.style.height = textarea.scrollHeight + 'px';
    }

    if (textarea.attachEvent) {
        textarea.attachEvent('oninput', autoResize); // Для устаревших версий браузеров
    } else {
        textarea.addEventListener('input', autoResize);
    }

</script>


{% endblock %}